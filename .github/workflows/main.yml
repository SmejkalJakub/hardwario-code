
name: main

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  get-all-needed-files:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Download Visual Studio Code Windows
        run: wget -O hardwario-code-windows.zip --no-check-certificate https://az764295.vo.msecnd.net/stable/30d9c6cd9483b2cc586687151bcbcd635f373630/VSCode-win32-x64-1.68.1.zip

      - name: Create hardwario-code folder
        run: |
          mkdir artifact-windows
          mkdir artifact-windows/hardwario-code
          unzip hardwario-code-windows.zip -d artifact-windows/hardwario-code

      - uses: actions/upload-artifact@v2
        with:
          name: hardwario-code-windows
          path: ./artifact-windows
  
  windows-export:
    name: Export HARDWARIO Code Windows
    runs-on: windows-latest
    needs: [get-all-needed-files]

    steps:
      - uses: actions/checkout@v3
      - uses: actions/download-artifact@v2
        with:
          name: hardwario-code-windows
      - run: ls .
      - run: ls hardwario-code/

      - name: Install all extensions
        run: |
          mkdir hardwario-code/data
          cd hardwario-code/bin
          code --install-extension cschlosser.doxdocgen
          code --install-extension jeff-hykin.better-cpp-syntax
          code --install-extension marus25.cortex-debug
          code --install-extension ms-vscode.cmake-tools
          code --install-extension ms-vscode.cpptools
          code --install-extension ms-vscode.cpptools-extension-pack
          code --install-extension ms-vscode.cpptools-themes
          code --install-extension ms-vscode.vscode-serial-monitor
          code --install-extension ms-vscode-remote.remote-containers
          code --install-extension ms-vscode-remote.remote-ssh
          code --install-extension ms-vscode-remote.remote-ssh-edit
          code --install-extension ms-vscode-remote.remote-wsl
          code --install-extension twxs.cmake


